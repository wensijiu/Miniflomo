# ria - 图片上传功能说明

## ✨ 新功能概述

笔记现在支持上传图片！你可以通过相机拍照或从相册选择图片，与文字一起保存到笔记中。

---

## 📸 功能特性

### 1. **图片来源**
- 📷 **拍照** - 使用设备相机实时拍摄
- 🖼️ **相册** - 从设备相册选择现有照片

### 2. **多图支持**
- ✅ 一条笔记可以包含**多张图片**
- ✅ 支持添加、预览和删除图片
- ✅ 图片以网格形式优雅展示

### 3. **存储方式**
- 💾 **localStorage** - 图片以 base64 格式存储（适合离线使用）
- ☁️ **Supabase** - 云端存储支持（如果后端可用）
- 🔄 **自动降级** - 后端不可用时自动使用本地存储

### 4. **显示布局**
- **1 张图片** - 单列全宽显示
- **2 张图片** - 两列网格显示
- **3+ 张图片** - 三列网格显示

---

## 🚀 使用方法

### 在快速输入页添加图片

1. **打开输入页**
   - 点击底部导航的"输入"标签

2. **输入笔记内容**
   - 输入你想记录的文字（可选）

3. **添加图片**
   - 点击 **"拍照"** 按钮打开相机拍摄
   - 或点击 **"相册"** 按钮从相册选择

4. **管理图片**
   - 图片会以缩略图显示在输入框下方
   - 点击缩略图右上角的 **×** 删除图片
   - 可以添加多张图片

5. **保存笔记**
   - 点击底部的 **"发送"** 按钮保存
   - 笔记可以只包含图片，无需文字

### 查看带图片的笔记

1. **在回顾页浏览**
   - 切换到"回顾"标签
   - 笔记卡片中会自动显示图片

2. **图片布局**
   - 图片以网格形式展示
   - 点击图片可以查看（待实现全屏查看）

---

## 🔧 技术实现

### 数据结构

```typescript
interface Note {
  id: string;
  content: string;
  tags: string[];
  timestamp: number;
  images?: string[];  // 图片数组（base64 或 URL）
}
```

### API 更新

所有笔记相关的 API 都已更新以支持图片：

```typescript
// 创建笔记
createNote(phone, content, tags, images?)

// 更新笔记
updateNote(phone, noteId, content, tags, images?)

// 获取笔记（返回包含图片的笔记）
getNotes(userPhone)
```

### 使用的技术

- **Capacitor Camera Plugin** (`@capacitor/camera`) - 原生相机和相册访问
- **Base64 编码** - 图片存储格式
- **React Hooks** - 状态管理
- **Tailwind CSS** - 响应式布局

---

## 📱 原生应用支持

### Android
- ✅ 完全支持相机拍照
- ✅ 完全支持相册选择
- ✅ 自动请求相机和存储权限

### iOS
- ✅ 完全支持相机拍照
- ✅ 完全支持相册选择
- ✅ 自动请求相机和照片库权限

### 权限配置

打包原生应用后，需要在配置文件中添加权限：

**Android (`AndroidManifest.xml`):**
```xml
<uses-permission android:name="android.permission.CAMERA" />
<uses-permission android:name="android.permission.READ_EXTERNAL_STORAGE" />
<uses-permission android:name="android.permission.WRITE_EXTERNAL_STORAGE" />
```

**iOS (`Info.plist`):**
```xml
<key>NSCameraUsageDescription</key>
<string>需要访问相机以拍摄笔记照片</string>
<key>NSPhotoLibraryUsageDescription</key>
<string>需要访问相册以选择笔记图片</string>
```

这些权限会在用户首次使用相机/相册时自动请求。

---

## 🎨 UI 设计

### 快速输入页

```
┌─────────────────────────────────┐
│            ria                  │
├─────────────────────────────────┤
│                                 │
│   [文字输入区域]                 │
│                                 │
├─────────────────────────────────┤
│  #标签1  #标签2                  │
├─────────────────────────────────┤
│  ┌───┐ ┌───┐ ┌───┐              │
│  │图1│ │图2│ │图3│              │
│  └───┘ └───┘ └───┘              │
├─────────────────────────────────┤
│  📷 拍照    🖼️ 相册    3 张图片  │
├─────────────────────────────────┤
│       [  发送  ]                │
└─────────────────────────────────┘
```

### 笔记卡片

```
┌─────────────────────────────────┐
│ 这是一条带图片的笔记内容...       │
│                                 │
│  ┌─────┐ ┌─────┐ ┌─────┐        │
│  │     │ │     │ │     │        │
│  │图片1│ │图片2│ │图片3│        │
│  │     │ │     │ │     │        │
│  └─────┘ └─────┘ └─────┘        │
│                                 │
│  #旅行 #美食        昨天 14:23  │
└─────────────────────────────────┘
```

---

## 💡 使用建议

### 最佳实践

1. **图片质量**
   - 插件默认压缩质量为 80%，平衡质量和大小
   - 适合日常记录，不会占用过多存储空间

2. **图片数量**
   - 建议每条笔记 1-6 张图片
   - 过多图片可能影响加载速度

3. **使用场景**
   - 📷 美食记录 - 拍摄餐点照片
   - 🏞️ 旅行日记 - 记录风景和瞬间
   - 📝 学习笔记 - 拍摄书籍页面或板书
   - 💡 灵感收集 - 捕捉有趣的设计和想法
   - 📋 工作记录 - 保存重要文档或白板内容

### 注意事项

1. **存储限制**
   - localStorage 有 5-10MB 限制（浏览器）
   - 原生应用存储空间更大但仍需注意
   - 建议定期清理不需要的图片笔记

2. **网络同步**
   - 使用 Supabase 时，大图片可能上传较慢
   - 在弱网环境下会自动降级到本地存储

3. **隐私保护**
   - 图片以 base64 存储在本地或云端
   - 确保不拍摄敏感信息
   - 退出登录时不会删除本地图片数据

---

## 🔜 未来改进

计划中的功能增强：

- [ ] **图片全屏查看** - 点击图片查看大图
- [ ] **图片轮播** - 多图滑动浏览
- [ ] **图片编辑** - 裁剪、旋转、滤镜
- [ ] **OCR 文字识别** - 从图片提取文字
- [ ] **图片搜索** - 按图片内容搜索笔记
- [ ] **批量上传** - 一次选择多张图片
- [ ] **压缩选项** - 自定义图片质量
- [ ] **云存储优化** - 使用 Supabase Storage 提升性能

---

## 🐛 已知问题

### Web 端限制
- 浏览器环境下无法直接访问原生相机
- 需要通过文件选择器上传
- 建议使用原生应用获得最佳体验

### 解决方案
打包成 Android/iOS 应用后，可以完美支持原生相机和相册访问。

---

## 📊 性能考虑

### Base64 vs 文件 URL

**当前方案（Base64）：**
- ✅ 简单易实现
- ✅ 完全离线支持
- ✅ 跨平台兼容
- ⚠️ 数据体积增加约 33%
- ⚠️ 可能影响 localStorage 限制

**未来优化（Supabase Storage）：**
- ✅ 节省本地存储空间
- ✅ 支持更大的图片
- ✅ 更快的加载速度
- ⚠️ 需要网络连接
- ⚠️ 需要配置存储桶

---

## 🎯 快速开始

### 1. 安装依赖

```bash
npm install @capacitor/camera
```

### 2. 同步到原生项目

```bash
npm run build
npx cap sync
```

### 3. 在 Android Studio 或 Xcode 中配置权限

权限会在首次使用时自动请求。

### 4. 开始使用

打开应用 → 输入页 → 点击"拍照"或"相册" → 添加图片 → 发送！

---

## 📞 技术支持

如有问题或建议，请查看：

- 📖 [Capacitor Camera 文档](https://capacitorjs.com/docs/apis/camera)
- 💬 查看 `/src/app/components/QuickInputPage.tsx` 源码
- 🔧 查看 `/src/app/utils/api.ts` API 实现

---

**🎉 现在就开始用图片丰富你的笔记吧！**
